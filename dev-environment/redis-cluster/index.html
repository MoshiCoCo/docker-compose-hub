<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>DockerComposeHub</title>
    <meta name="description" content="DockerComposeHub">
    <meta name="generator" content="VitePress v1.1.3">
    <link rel="preload stylesheet" href="/assets/style.D7Ui18eB.css" as="style">
    
    <script type="module" src="/assets/app.DjoAMslG.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.-Zveb6AF.js">
    <link rel="modulepreload" href="/assets/chunks/theme.DrZf1IGv.js">
    <link rel="modulepreload" href="/assets/dev-environment_redis-cluster_index.md.B66oKB5o.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar has-sidebar top" data-v-ae24b3ad data-v-ccf7ddec><div class="wrapper" data-v-ccf7ddec><div class="container" data-v-ccf7ddec><div class="title" data-v-ccf7ddec><div class="VPNavBarTitle has-sidebar" data-v-ccf7ddec data-v-ab179fa1><a class="title" href="/" data-v-ab179fa1><!--[--><!--]--><!----><span data-v-ab179fa1>DockerComposeHub</span><!--[--><!--]--></a></div></div><div class="content" data-v-ccf7ddec><div class="content-body" data-v-ccf7ddec><!--[--><!--]--><div class="VPNavBarSearch search" data-v-ccf7ddec><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-ccf7ddec data-v-7f418b0f><span id="main-nav-aria-label" class="visually-hidden" data-v-7f418b0f>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-7f418b0f data-v-9c663999><!--[--><span data-v-9c663999>首页</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/tools/" tabindex="0" data-v-7f418b0f data-v-9c663999><!--[--><span data-v-9c663999>常用工具</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/dev-environment/" tabindex="0" data-v-7f418b0f data-v-9c663999><!--[--><span data-v-9c663999>开发工具</span><!--]--></a><!--]--><!--]--></nav><div class="VPFlyout VPNavBarTranslations translations" data-v-ccf7ddec data-v-88af2de4 data-v-b6c34ac9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="Change language" data-v-b6c34ac9><span class="text" data-v-b6c34ac9><span class="vpi-languages option-icon" data-v-b6c34ac9></span><!----><span class="vpi-chevron-down text-icon" data-v-b6c34ac9></span></span></button><div class="menu" data-v-b6c34ac9><div class="VPMenu" data-v-b6c34ac9 data-v-e7ea1737><!----><!--[--><!--[--><div class="items" data-v-88af2de4><p class="title" data-v-88af2de4>简体中文</p><!--[--><div class="VPMenuLink" data-v-88af2de4 data-v-43f1e123><a class="VPLink link" href="/en_us/dev-environment/redis-cluster/" data-v-43f1e123><!--[-->English<!--]--></a></div><!--]--></div><!--]--><!--]--></div></div></div><div class="VPNavBarAppearance appearance" data-v-ccf7ddec data-v-e6aabb21><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-e6aabb21 data-v-d1f28634 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-d1f28634></span><span class="vpi-moon moon" data-v-d1f28634></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-ccf7ddec data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-eee4e7cb><span class="vpi-social-github" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-ccf7ddec data-v-d0bd9dde data-v-b6c34ac9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-b6c34ac9><span class="vpi-more-horizontal icon" data-v-b6c34ac9></span></button><div class="menu" data-v-b6c34ac9><div class="VPMenu" data-v-b6c34ac9 data-v-e7ea1737><!----><!--[--><!--[--><div class="group translations" data-v-d0bd9dde><p class="trans-title" data-v-d0bd9dde>简体中文</p><!--[--><div class="VPMenuLink" data-v-d0bd9dde data-v-43f1e123><a class="VPLink link" href="/en_us/dev-environment/redis-cluster/" data-v-43f1e123><!--[-->English<!--]--></a></div><!--]--></div><div class="group" data-v-d0bd9dde><div class="item appearance" data-v-d0bd9dde><p class="label" data-v-d0bd9dde>Appearance</p><div class="appearance-action" data-v-d0bd9dde><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-d0bd9dde data-v-d1f28634 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-d1f28634></span><span class="vpi-moon moon" data-v-d1f28634></span><!--]--></span></span></button></div></div></div><div class="group" data-v-d0bd9dde><div class="item social-links" data-v-d0bd9dde><div class="VPSocialLinks social-links-list" data-v-d0bd9dde data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-eee4e7cb><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-ccf7ddec data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-ccf7ddec><div class="divider-line" data-v-ccf7ddec></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-267dd0ed><button data-v-267dd0ed>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-575e6a36><div class="curtain" data-v-575e6a36></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-575e6a36><span class="visually-hidden" id="sidebar-aria-label" data-v-575e6a36> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0 has-active" data-v-575e6a36 data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><h2 class="text" data-v-b8d55f3b>开发环境</h2><!----></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/dev-environment/mysql/" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>MySql</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/dev-environment/redis/" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Redis</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/dev-environment/redis-cluster/" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Redis Cluster</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/dev-environment/minio/" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>MinIO</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/dev-environment/drone/" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Drone</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/dev-environment/nginx-consul-registrator/" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Nginx</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/dev-environment/portainer/" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Portainer</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/dev-environment/rabbit-mq/" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Rabbit MQ</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-3f215769 data-v-935f8a84><div class="content" data-v-935f8a84><div class="outline-marker" data-v-935f8a84></div><div class="outline-title" role="heading" aria-level="2" data-v-935f8a84>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-935f8a84><span class="visually-hidden" id="doc-outline-aria-label" data-v-935f8a84> Table of Contents for current page </span><ul class="VPDocOutlineItem root" data-v-935f8a84 data-v-b933a997><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _dev-environment_redis-cluster_" data-v-39a288b8><div><h2 id="redis-集群" tabindex="-1">Redis 集群 <a class="header-anchor" href="#redis-集群" aria-label="Permalink to &quot;Redis 集群&quot;">​</a></h2><p>3主3丛的redis单机集群。</p><h2 id="使用步骤" tabindex="-1">使用步骤 <a class="header-anchor" href="#使用步骤" aria-label="Permalink to &quot;使用步骤&quot;">​</a></h2><h2 id="创建模板文件-redis-cluster-tmpl" tabindex="-1">创建模板文件 <code>redis-cluster.tmpl</code> <a class="header-anchor" href="#创建模板文件-redis-cluster-tmpl" aria-label="Permalink to &quot;创建模板文件 `redis-cluster.tmpl`&quot;">​</a></h2><p>注意，模板文件中所有<code>${}</code>包裹的值均为后续shell命令传递的，请勿在模板文件中修改，其他值则可在模板文件中修改。</p><div class="language-yml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># redis端口</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">port ${PORT}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">daemonize no</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 关闭保护模式</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">protected-mode no</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 开启集群</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cluster-enabled yes</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 集群节点配置</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cluster-config-file nodes.conf</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 超时</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cluster-node-timeout 5000</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 集群节点IP host模式为宿主机IP</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cluster-announce-ip ${HOST}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 集群节点端口 7001 - 7006</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cluster-announce-port ${PORT}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">cluster-announce-bus-port 1${PORT}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 开启 appendonly 备份模式</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">appendonly yes</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 每秒钟备份</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">appendfsync everysec</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 对aof文件进行压缩时，是否执行同步操作</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">no-appendfsync-on-rewrite no</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 当目前aof文件大小超过上一次重写时的aof文件大小的100%时会再次进行重写</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">auto-aof-rewrite-percentage 100</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 重写前AOF文件的大小最小值 默认 64mb</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">auto-aof-rewrite-min-size 64mb</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">masterauth ${masterauth}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">requirepass ${requirepass}</span></span></code></pre></div><h2 id="通过模板文件初始化redis节点文件" tabindex="-1">通过模板文件初始化redis节点文件 <a class="header-anchor" href="#通过模板文件初始化redis节点文件" aria-label="Permalink to &quot;通过模板文件初始化redis节点文件&quot;">​</a></h2><p>创建redis-cluster.tmpl 后，需要在run.sh预先配置masterauth 和 requirepass值，一个是集群通信认证密码，一个是redis集群密码，以及宿主机IP。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HOST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;宿主机地址&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">masterauth</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;自定义密码&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">requirepass</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;自定义密码&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#生成Redis结点文件</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> port </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> $(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">seq</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 7000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 7005</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">${port}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/conf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        PORT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">${port}  HOST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">${HOST} masterauth</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">${masterauth} requirepass</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">${requirepass} </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">envsubst</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./redis-cluster.tmpl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">${port}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/conf/redis.conf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">${port}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/data</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">done</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;init redis conf file success &quot;</span></span></code></pre></div><h2 id="启动集群各个节点" tabindex="-1">启动集群各个节点 <a class="header-anchor" href="#启动集群各个节点" aria-label="Permalink to &quot;启动集群各个节点&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span></span></code></pre></div><h2 id="创建集群" tabindex="-1">创建集群 <a class="header-anchor" href="#创建集群" aria-label="Permalink to &quot;创建集群&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HOST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;宿主机地址,同上&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">masterauth</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;自定义密码，同上&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">requirepass</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;自定义密码，同上&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">redis-cli</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cluster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $HOST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:7000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $HOST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:7001</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $HOST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:7002</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $HOST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:7003</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $HOST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:7004</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $HOST</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:7005</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cluster-replicas</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${requirepass}</span></span></code></pre></div><h2 id="多主机节点集群" tabindex="-1">多主机节点集群 <a class="header-anchor" href="#多主机节点集群" aria-label="Permalink to &quot;多主机节点集群&quot;">​</a></h2><h2 id="方案1" tabindex="-1">方案1 <a class="header-anchor" href="#方案1" aria-label="Permalink to &quot;方案1&quot;">​</a></h2><p>注意，此编排文件适用于单机集群，如果你需要将集群部署在多台机器上，请修改生成的节点配置文件，然后将节点配置文件上传到不同的服务器上。注意不同节点需要配置不同的主机地址和端口。</p><p>例如生成7001-7005的节点配置文件，可以手动修改每个配置文件的主机地址，假设3台主机的主机地址分别为：</p><p>172.123.123.121 172.123.123.122 172.123.123.122</p><p>可以将7000和7001的节点配置文件的主机地址修改为172.123.123.121，7002和7003的主机地址修改为172.123.123.122，7004和7005的主机地址修改为172.123.123.123</p><p>然后将docker-compose编排文件中的service2个一组，重新编排为3个compose文件，在不同的主机上启动即可。</p><p>之后创建集群即可。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">redis-cli</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cluster</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 172.123.123.121:7000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 172.123.123.121:7001</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 172.123.123.122:7002</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 172.123.123.122:7003</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">172.123.123.123:7004</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 172.123.123.123:7005</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cluster-replicas</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${requirepass}</span></span></code></pre></div><h2 id="方案2" tabindex="-1">方案2 <a class="header-anchor" href="#方案2" aria-label="Permalink to &quot;方案2&quot;">​</a></h2><p>使用单机版本的redis编排文件，使用指定配置文件（可直接使用redis-cluster.tmpl重命名为redis.conf）方式在不同的机器上启动redis容器。 ，在compose文件需要暴露集群通讯端口，然后使用<code>redis-cli --cluster create</code>命令创建集群即可。</p><p>redis.conf 文件示例</p><div class="language-conf vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">conf</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>daemonize no</span></span>
<span class="line"><span>  # 关闭保护模式</span></span>
<span class="line"><span>protected-mode no</span></span>
<span class="line"><span>  # 开启集群</span></span>
<span class="line"><span>cluster-enabled yes</span></span>
<span class="line"><span>  # 集群节点配置</span></span>
<span class="line"><span>cluster-config-file nodes.conf</span></span>
<span class="line"><span>  # 超时</span></span>
<span class="line"><span>cluster-node-timeout 5000</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  # 开启 appendonly 备份模式</span></span>
<span class="line"><span>appendonly yes</span></span>
<span class="line"><span>  # 每秒钟备份</span></span>
<span class="line"><span>appendfsync everysec</span></span>
<span class="line"><span>  # 对aof文件进行压缩时，是否执行同步操作</span></span>
<span class="line"><span>no-appendfsync-on-rewrite no</span></span>
<span class="line"><span>  # 当目前aof文件大小超过上一次重写时的aof文件大小的100%时会再次进行重写</span></span>
<span class="line"><span>auto-aof-rewrite-percentage 100</span></span>
<span class="line"><span>  # 重写前AOF文件的大小最小值 默认 64mb</span></span>
<span class="line"><span>auto-aof-rewrite-min-size 64mb</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  # 集群节点IP host模式为宿主机IP  需要配置主机IP</span></span>
<span class="line"><span>cluster-announce-ip ${HOST}</span></span>
<span class="line"><span>  # redis端口</span></span>
<span class="line"><span>port 6379</span></span>
<span class="line"><span>  # 集群节点端口 </span></span>
<span class="line"><span>cluster-announce-port 6379</span></span>
<span class="line"><span>cluster-announce-bus-port 16379</span></span>
<span class="line"><span>  #需要配置密码 </span></span>
<span class="line"><span>masterauth ${masterauth}</span></span>
<span class="line"><span>  #需要配置密码 </span></span>
<span class="line"><span>requirepass ${requirepass}</span></span></code></pre></div><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  redis</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 镜像名称以及版本号</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">redis</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 失败后总是重启</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    restart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">always</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 自定义容器名</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    container_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">redis-6379</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 文件夹以及文件映射</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$PWD/data:/data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$PWD/logs:/logs</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$PWD/redis.conf:/usr/local/etc/redis/redis.conf</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;redis-server&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/usr/local/etc/redis/redis.conf&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # 端口号</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;6379:6379&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;16379:16379&quot;</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-09de1c0f><!--[--><!--]--><!----><nav class="prev-next" data-v-09de1c0f><div class="pager" data-v-09de1c0f><a class="VPLink link pager-link prev" href="/dev-environment/redis/" data-v-09de1c0f><!--[--><span class="desc" data-v-09de1c0f>Previous page</span><span class="title" data-v-09de1c0f>Redis</span><!--]--></a></div><div class="pager" data-v-09de1c0f><a class="VPLink link pager-link next" href="/dev-environment/minio/" data-v-09de1c0f><!--[--><span class="desc" data-v-09de1c0f>Next page</span><span class="title" data-v-09de1c0f>MinIO</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"dev-environment_portainer_edge-agent_readme.md\":\"jnK4-7Km\",\"tools_wordpress_index.md\":\"C6SqRuEK\",\"docker_install-docker-and-compose.md\":\"D-ZXJBXP\",\"dev-environment_mysql_index.md\":\"Cxy2w8AU\",\"index.md\":\"BhKmnEK8\",\"projet-info_support-list.md\":\"_8d_ZcR9\",\"tools_acme-sh_index.md\":\"hi2CO73D\",\"tools_drawio_index.md\":\"BxmIqPiR\",\"tools_emby_index.md\":\"DZRyPxt-\",\"tools_bark_index.md\":\"CyuhVSnu\",\"tools_frp_index.md\":\"CSk3EBgS\",\"dev-environment_portainer_server_readme.md\":\"DtIMzrtP\",\"dev-environment_redis-cluster_index.md\":\"B66oKB5o\",\"docker_about-compose.md\":\"DTIIKufr\",\"dev-environment_index.md\":\"c47SzVT8\",\"dev-environment_minio_index.md\":\"Dhat-VZY\",\"tools_halo_index.md\":\"HIdA19BA\",\"tools_index.md\":\"CuGav9k8\",\"dev-environment_nginx-consul-registrator_index.md\":\"DLDEpQ_q\",\"dev-environment_redis_index.md\":\"BY7_hpAB\",\"dev-environment_portainer_index.md\":\"D0-bUWZC\",\"dev-environment_portainer_nas-agent_readme.md\":\"BUHNJstg\",\"tools_qinglong_index.md\":\"Blm3pzgV\",\"dev-environment_drone_index.md\":\"C59uwOFX\",\"tools_vaultwarden_index.md\":\"BQ7VO5pQ\",\"dev-environment_rabbit-mq_index.md\":\"Cam6rA9q\",\"tools_netdata_index.md\":\"DuYt6KNM\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"DockerComposeHub\",\"description\":\"DockerComposeHub\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"i18nRouting\":true,\"search\":{\"provider\":\"local\"},\"outline\":[2,3],\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Examples\",\"link\":\"/markdown-examples\"},{\"text\":\"DevTools\",\"link\":\"/tools\"},{\"text\":\"DevEnv\",\"link\":\"/dev-environment\"}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/vuejs/vitepress\"}]},\"locales\":{\"root\":{\"label\":\"简体中文\",\"title\":\"DockerComposeHub\",\"description\":\"DockerComposeHub\",\"themeConfig\":{\"nav\":[{\"text\":\"首页\",\"link\":\"/\"},{\"text\":\"常用工具\",\"link\":\"/tools/\",\"activeMatch\":\"/tools\"},{\"text\":\"开发工具\",\"link\":\"/dev-environment/\",\"activeMatch\":\"/dev-environment\"}],\"sidebar\":{\"/tools/\":[{\"text\":\"常用工具\",\"items\":[{\"text\":\"Bark\",\"link\":\"/tools/bark/\"},{\"text\":\"Halo\",\"link\":\"/tools/halo/\"},{\"text\":\"Acme sh\",\"link\":\"/tools/acme-sh/\"},{\"text\":\"Drawio\",\"link\":\"/tools/drawio/\"},{\"text\":\"Emby\",\"link\":\"/tools/emby/\"},{\"text\":\"Frp\",\"link\":\"/tools/frp/\"},{\"text\":\"NetData\",\"link\":\"/tools/netdata/\"},{\"text\":\"QingLong\",\"link\":\"/tools/qinglong/\"},{\"text\":\"VaultWarden\",\"link\":\"/tools/vaultwarden/\"},{\"text\":\"WordPress\",\"link\":\"/tools/wordpress/\"}]}],\"/dev-environment/\":[{\"text\":\"开发环境\",\"items\":[{\"text\":\"MySql\",\"link\":\"/dev-environment/mysql/\"},{\"text\":\"Redis\",\"link\":\"/dev-environment/redis/\"},{\"text\":\"Redis Cluster\",\"link\":\"/dev-environment/redis-cluster/\"},{\"text\":\"MinIO\",\"link\":\"/dev-environment/minio/\"},{\"text\":\"Drone\",\"link\":\"/dev-environment/drone/\"},{\"text\":\"Nginx\",\"link\":\"/dev-environment/nginx-consul-registrator/\"},{\"text\":\"Portainer\",\"link\":\"/dev-environment/portainer/\"},{\"text\":\"Rabbit MQ\",\"link\":\"/dev-environment/rabbit-mq/\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/vuejs/vitepress\"}]}},\"en_us\":{\"label\":\"English\",\"title\":\"DockerComposeHub\",\"lang\":\"en-US\",\"description\":\"DockerComposeHub\",\"themeConfig\":{\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Examples\",\"link\":\"/markdown-examples\"},{\"text\":\"DevTools\",\"link\":\"/tools\"},{\"text\":\"DevEnv\",\"link\":\"/dev-environment\"}],\"sidebar\":[{\"text\":\"Examples\",\"items\":[{\"text\":\"Markdown Examples\",\"link\":\"/markdown-examples\"},{\"text\":\"Runtime API Examples\",\"link\":\"/api-examples\"}]}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/vuejs/vitepress\"}]}}},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>